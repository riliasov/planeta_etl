# Data from Google Sheets to Supabase

–ü—Ä–æ–µ–∫—Ç –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Google Sheets –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL –≤ Supabase.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

1. **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ** - –ø—Ä–æ–¥–∞–∂–∏ –∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
2. **–î–∞–Ω–Ω—ã–µ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º** –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
3. **–¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ** - –ø—Ä–æ–¥–∞–∂–∏ –∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
4. **–¢–µ–∫—É—â–∏–µ –æ–±—Ä–∞—â–µ–Ω–∏—è** –∏ –Ω–æ–≤—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
5. **–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏** - —Å—Ç–∞–≤–∫–∏, –ø—Ä–∞–π—Å–ª–∏—Å—Ç—ã –∏ –ø—Ä–æ—á–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
6. **–†–∞—Å—Ö–æ–¥—ã** - –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –∏ —Ç–µ–∫—É—â–∏–µ

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python3 -m venv venv

# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source venv/bin/activate  # macOS/Linux
# –∏–ª–∏
venv\Scripts\activate  # Windows

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google Sheets API

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Google Cloud Console](https://console.cloud.google.com/)
2. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
3. –í–∫–ª—é—á–∏—Ç–µ "Google Sheets API" –∏ "Google Drive API"
4. –°–æ–∑–¥–∞–π—Ç–µ Service Account:
   - APIs & Services ‚Üí Credentials ‚Üí Create Credentials ‚Üí Service Account
   - –°–æ–∑–¥–∞–π—Ç–µ –∫–ª—é—á (JSON —Ñ–æ—Ä–º–∞—Ç)
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ JSON —Ñ–∞–π–ª –≤ –ø–∞–ø–∫—É `secrets/` (–ª—é–±–æ–µ –∏–º—è, –Ω–∞–ø—Ä–∏–º–µ—Ä `planeta_sheets_key.json`)
6. –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –∫–∞–∂–¥–æ–π Google —Ç–∞–±–ª–∏—Ü–µ–π —Å email –∏–∑ –ø–æ–ª—è `client_email` –≤ JSON —Ñ–∞–π–ª–µ

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `sources.json.example` –≤ `secrets/sources.json` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ:

```json
{
    "historical_sales": {
        "spreadsheet_id": "ID_–í–ê–®–ï–ô_–¢–ê–ë–õ–ò–¶–´",
        "sheet_names": ["–ù–∞–∑–≤–∞–Ω–∏–µ_–ª–∏—Å—Ç–∞"],
        "ranges": {
            "–ù–∞–∑–≤–∞–Ω–∏–µ_–ª–∏—Å—Ç–∞": "A1:Z1000"
        }
    }
}
```

**–ì–¥–µ –Ω–∞–π—Ç–∏ `spreadsheet_id`?**
–í URL —Ç–∞–±–ª–∏—Ü—ã: `https://docs.google.com/spreadsheets/d/SPREADSHEET_ID/edit`

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` (—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏–∑ `.env.example`):

```bash
SUPABASE_DB_URL=postgresql://user:password@host:port/dbname
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤–æ–µ —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

```bash
source venv/bin/activate
python tests/test_sheets_connection.py
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

```bash
python main.py --check-connection
```

### –ó–∞–ø—É—Å–∫ ETL

```bash
# –í—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
python main.py --sync=all

# –¢–æ–ª—å–∫–æ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
python main.py --sync=historical

# –¢–æ–ª—å–∫–æ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
python main.py --sync=current

# –¢–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç—ã
python main.py --sync=clients

# –¢–æ–ª—å–∫–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏
python main.py --sync=references
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **–ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** - –∫–∞–∂–¥—ã–π —Ç–∏–ø –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏–º–µ–µ—Ç —Å–≤–æ–π –º–æ–¥—É–ª—å –≤ `src/etl/`
- **–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞** - `main.py` —Å —Ñ–ª–∞–≥–∞–º–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
- **Read-only –¥–æ—Å—Ç—É–ø –∫ Sheets** - —Å–∫—Ä–∏–ø—Ç –ù–ï –ú–û–ñ–ï–¢ –∏–∑–º–µ–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ Google Sheets
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –≤ –ë–î –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### Ranges –¥–ª—è —Ç–∞–±–ª–∏—Ü

–í `sources.json` –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã –¥–ª—è —á—Ç–µ–Ω–∏—è:

```json
"ranges": {
    "–ü—Ä–æ–¥–∞–∂–∏": "A1:Z1000",  // –ü–µ—Ä–≤—ã–µ 1000 —Å—Ç—Ä–æ–∫
    "–ö–ª–∏–µ–Ω—Ç—ã": "A1:Z"        // –í—Å–µ —Å—Ç—Ä–æ–∫–∏, –∫–æ–ª–æ–Ω–∫–∏ A-Z
}
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

–ü–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –≤ –ë–î –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤ (–¥–∞—Ç—ã, email –∏ —Ç.–¥.)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞
2. ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets (read-only)
3. ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ranges –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã
4. üîÑ –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
5. üîÑ –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
6. üîÑ –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ë–î
7. ‚è≥ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
8. ‚è≥ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è ETL –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö
9. ‚è≥ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
10. ‚è≥ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
